@if(loading()) {
<div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">
  <mat-spinner mode="indeterminate" diameter="40"></mat-spinner>
</div>
} @else {
<mat-dialog-content class="overflow-hidden! flex flex-col h-full">
  <div class="px-4 pt-6 pb-4 flex flex-col items-center gap-4">
    <img
      class="w-24 h-24 rounded-full"
      [src]="imagePath + 'profileImages/' + channelData().avatar_url"
      alt="Channel Image"
    />
    <h2 class="text-2xl font-medium">{{ channelData().title }}</h2>
  </div>
  <div class="px-8 py-2 flex flex-col gap-4">
    @if(channelData().topic) {
    <div class="flex gap-2 items-start">
      <h3 class="lg:text-xl md:text-lg text-base">Topic:-</h3>
      <p class="text-sm md:text-base lg:text-lg">{{ channelData().topic }}</p>
    </div>
    } @if(channelData().description) {
    <div class="flex gap-2 items-start w-full">
      <h3 class="lg:text-xl md:text-lg text-base shrink-0">Description:-</h3>
      <div class="flex-1 overflow-hidden">
        <div
          class="description-container transition-all duration-500 ease-in-out"
          [class.collapsed]="!expendText()"
          [class.expanded]="expendText()"
        >
          <p class="text-sm md:text-base lg:text-lg">
            {{ channelData().description }}
          </p>
        </div>
        @if(channelData().description.length > 120) {
        <div class="flex justify-end mt-1">
          <button
            matMiniFab
            (click)="expendText.set(!expendText())"
            class="text-xs! h-6 leading-none min-w-0 px-2 text-(--mat-sys-primary) font-medium shadow-none!"
          >
            <mat-icon>{{ expendText() ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </div>
        }
      </div>
    </div>
    }
  </div>
  <div class="flex-1 overflow-y-auto min-h-0">
    <ul class="flex flex-col pt-4 justify-center items-center">
      @if(channelData().isMember) { @for(member of channelData().ChannelMembers; track $index) {
      <li class="py-2 px-2 w-full md:w-1/2">
        <div class="">
          <mat-card class="shadow-none! border! border-(--mat-sys-outline)!">
            <mat-card-header>
              <div
                mat-card-avatar
                class="bg-cover"
                [style.background-image]="
                  'url(' + imagePath + 'profileImages/' + member.avatar_url + ')'
                "
              ></div>
              <mat-card-title class="text-lg! text-(--mat-sys-on-surface)"
                >{{ member.full_name }}
                @if(member.id === userService.user()?.id) {
                <span class="text-xs! text-(--mat-sys-on-surface)">(You)</span>
                }
              </mat-card-title>
              <mat-card-subtitle class="text-base! font-normal! text-(--mat-sys-on-surface)">{{
                member.role
              }}</mat-card-subtitle>
              @if(channelData().isMember && channelData().owner_id === userService.user()?.id) {
              <div class="order-3! ms-auto!">
                <button ngMenuTrigger #origin #trigger="ngMenuTrigger" [menu]="formatMenu()">
                  <mat-icon>more_vert</mat-icon>
                </button>
              </div>
              <ng-template
                [cdkConnectedOverlayOpen]="trigger.expanded()"
                [cdkConnectedOverlay]="{origin, usePopover: 'inline'}"
                [cdkConnectedOverlayPositions]="[
                  {
                    originX: 'start',
                    originY: 'bottom',
                    overlayX: 'start',
                    overlayY: 'top',
                    offsetY: 4
                  }
                ]"
                cdkAttachPopoverAsChild
              >
                <div ngMenu #formatMenu="ngMenu">
                  <ng-template ngMenuContent>
                    <div class="group">
                      <div ngMenuItem value="Info" (click)="onMenuAction('Info', member)">
                        <mat-icon translate="no" aria-hidden="true">info</mat-icon>
                        <span class="label">Info</span>
                      </div>
                      <div
                        ngMenuItem
                        value="Promote as Admin"
                        (click)="onMenuAction('Promote as Admin', member)"
                      >
                        <mat-icon translate="no" aria-hidden="true">admin_panel_settings</mat-icon>
                        <span class="label">Promote as Admin</span>
                      </div>
                      <div
                        ngMenuItem
                        value="Promote as Owner"
                        (click)="onMenuAction('Promote as Owner', member)"
                      >
                        <mat-icon translate="no" aria-hidden="true">stars</mat-icon>
                        <span class="label">Promote as Owner</span>
                      </div>
                      <div
                        ngMenuItem
                        value="Demote as Member"
                        (click)="onMenuAction('Demote as Member', member)"
                      >
                        <mat-icon translate="no" aria-hidden="true">remove_moderator</mat-icon>
                        <span class="label">Demote as Member</span>
                      </div>
                      <div ngMenuItem value="Remove" (click)="onMenuAction('Remove', member)">
                        <mat-icon translate="no" aria-hidden="true">remove</mat-icon>
                        <span class="label">Remove user</span>
                      </div>
                    </div>
                  </ng-template>
                </div>
              </ng-template>
              }
            </mat-card-header>
          </mat-card>
        </div>
      </li>
      } }
    </ul>
  </div>
</mat-dialog-content>
<mat-dialog-actions>
  <button matButton (click)="close()">Close</button>
  @if(data.fromGroup) {
  <button
    matButton
    class="text-(--mat-sys-error)! bg-(--mat-sys-error-container)/40! hover:bg-(--mat-sys-error-container)!"
    (click)="leaveChannel()"
  >
    Leave
  </button>
  } @else { @if(channelData().isMember) {
  <button matButton (click)="redirect(channelData().id)">Open</button>
  } @else {
  <button matButton (click)="joinChannel()">Join</button>
  } }
</mat-dialog-actions>
}
